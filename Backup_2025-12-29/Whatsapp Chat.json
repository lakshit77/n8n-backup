{
  "updatedAt": "2025-12-29T11:32:20.000Z",
  "createdAt": "2025-11-13T11:34:53.834Z",
  "id": "V1GolwUDxcGbl6aY",
  "name": "Whatsapp Chat",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "a2ef0698-a3a2-4cca-954a-43a6ab0d7162",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        -80
      ],
      "id": "b40b9b51-7521-4d2b-826b-8874d1e730de",
      "name": "Webhook",
      "webhookId": "a2ef0698-a3a2-4cca-954a-43a6ab0d7162"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $json.body.To }}"
            },
            {
              "name": "ContentSid",
              "value": "HX67dec374c3290ba042afc2e69e75f8c1"
            },
            {
              "name": "ContentVariables",
              "value": "={\"1\":\"{{ $json.body.ProfileName }}\"}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -688,
        48
      ],
      "id": "827f7c7e-60cd-4b31-b7c8-79b92825bfd7",
      "name": "Send Initial Template",
      "credentials": {
        "httpBasicAuth": {
          "id": "WsQzmrY4u3R3NvDi",
          "name": "Twillio cred 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c285b704-a505-4d8a-a018-83f7cc0070f0",
              "leftValue": "={{ $json.body.MessageType }}",
              "rightValue": "interactive",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -912,
        -80
      ],
      "id": "1047b585-12d9-4f4d-94a6-fcea6537f400",
      "name": "Check if Template"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -464,
        -688
      ],
      "id": "94d72d0f-a105-4cad-8bdb-05f815312402",
      "name": "Get row(s) in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://content.twilio.com/v1/Content",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"friendly_name\": \"baby_product_template\",\n  \"language\": \"en\",\n  \"types\": {\n    \"twilio/list-picker\": {\n      \"body\": \"Choose a product to view the details\",\n      \"button\": \"Select Product\",\n      \"items\": {{$node[\"mapping_item\"].json[\"items_stringified\"]}}\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -16,
        -688
      ],
      "id": "355d4ec5-ffca-45bb-984a-b54b02327e38",
      "name": "Create List picker template OG",
      "credentials": {
        "httpHeaderAuth": {
          "id": "XbgCnjmIOf3tN8o7",
          "name": "Twillio cred 2"
        },
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Convert Excel rows â†’ PROPER JSON array ready for Twilio\nconst MAX_ITEMS = 10;\n  const TITLE_MAX = 24;\nconst DESC_MAX = 72;\n\nconst rows = $input.all().map(i => i.json);\n\nfunction trunc(s,n){ \n  if (!s) return \"\"; \n  s = String(s); \n  return s.length<=n ? s : s.slice(0,n-1)+\"â€¦\"; \n}\n\n// Order by in-stock first\nconst inStock = rows.filter(r => (r.availability || '').toLowerCase() === 'in stock');\nconst others   = rows.filter(r => !inStock.includes(r));\nconst ordered  = inStock.concat(others).slice(0, MAX_ITEMS);\n\n// Build Twilio List Picker items\nconst listItems = ordered.map(p => {\n  const id = String(p.id);\n  const title = trunc(p.title, TITLE_MAX);\n  const description = trunc(p.description ?? `â‚¹${p.price} â€¢ ${p.availability}`, DESC_MAX);\n  return {\n    item: title,\n    description: description,\n    id: id\n  };\n});\n\n// Return BOTH versions:\n// 1. Normal JSON array\n// 2. Stringified JSON array (for display)\nreturn [{\n  json: {\n    items: listItems,\n    items_stringified: JSON.stringify(listItems, null, 2)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -240,
        -688
      ],
      "id": "2a670e03-2f63-416f-a240-6772e5987ca4",
      "name": "mapping_item"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.ButtonPayload }}",
                    "rightValue": "browse_product",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7c6ca04-7747-406d-ab76-cd29c0e07c09"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Browse Product"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9ce7a61-a4ac-410d-a657-cc2043987041",
                    "leftValue": "={{ $json.body.ButtonPayload }}",
                    "rightValue": "confirm",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirm Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fa8a5bb5-2908-4bee-b7f7-b7d6cd329182",
                    "leftValue": "={{ $json.body.ButtonPayload }}",
                    "rightValue": "ask_faqs",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ask FAQs"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ac966a0-815a-4c1b-9c9c-2af2834b903f",
                    "leftValue": "={{ $json.body.ButtonPayload }}",
                    "rightValue": "cancel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancel Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a082f7c7-a09f-4524-8298-89fadaaf58c6",
                    "leftValue": "={{ $json.body.Body }}",
                    "rightValue": "_",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "No of Quantity"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "623c6501-41f9-456d-864f-72f89f0ec8a6",
                    "leftValue": "={{ $json.body.MessageType }}",
                    "rightValue": "interactive",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ask Quantity"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -688,
        -272
      ],
      "id": "07b0d4a1-0940-4d90-9e55-0903d622edab",
      "name": "Switch"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $node['Webhook'].json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $node['Webhook'].json.body.To }}"
            },
            {
              "name": "ContentSid",
              "value": "={{ $json.sid }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        208,
        -688
      ],
      "id": "0900b854-6c30-4ae3-82db-7ab40be0f30c",
      "name": "Send Template",
      "credentials": {
        "httpBasicAuth": {
          "id": "WsQzmrY4u3R3NvDi",
          "name": "Twillio cred 2"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://content.twilio.com/v1/Content",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"friendly_name\": \"baby_product_template\",\n  \"language\": \"en\",\n  \"types\": {\n    \"twilio/list-picker\": {\n      \"body\": \"{{ $json.body }}\",\n      \"button\": \"{{ $json.button }}\",\n      \"items\": {{$node[\"list_quantity\"].json[\"items_stringified\"]}}\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -240,
        272
      ],
      "id": "c2908f8e-371a-49a0-8708-f5f024e3d9a1",
      "name": "Create List Quantity picker ",
      "credentials": {
        "httpHeaderAuth": {
          "id": "XbgCnjmIOf3tN8o7",
          "name": "Twillio cred 2"
        },
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $node['Webhook'].json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $node['Webhook'].json.body.To }}"
            },
            {
              "name": "ContentSid",
              "value": "={{ $json.sid }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -16,
        272
      ],
      "id": "799a7aba-091a-4d48-963c-c0dc1d2e539f",
      "name": "Send Quantity Template",
      "credentials": {
        "httpBasicAuth": {
          "id": "WsQzmrY4u3R3NvDi",
          "name": "Twillio cred 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Function node: Quantity List Builder\n// Input: previous node is your Twilio webhook (so product selection data is in $json)\n// Output: { body, button, items_stringified }\n\n// --- Config\nconst MAX_Q = 10;\nconst BUTTON_TEXT = 'Select Qty';     // <=20 chars\nconst BODY_PREFIX = 'You selected';   // used to build the message\n\n// --- Helpers\nfunction trunc(s, n=60){ if (s===undefined||s===null) return ''; s=String(s); return s.length<=n? s : s.slice(0,n-1)+'â€¦'; }\n\n// --- Extract product identifier from common Twilio webhook fields\n// Try a few common locations: (adjust if your webhook stores elsewhere)\n\n// Common Twilio places seen in screenshots: payload.Body, payload.ListTitle, payload.body.ListTitle, payload.body.Body\nlet productIdentifier = $input.first().json.body.Body;\nlet productTitle = $input.first().json.body.ListTitle;\n\n\n// --- Build items array (1..MAX_Q). Use small 'item' titles and descriptions\nconst items = [];\nfor (let q = 1; q <= MAX_Q; q++) {\n  const idObj = `${q}_${productIdentifier}`;\n  items.push({\n    item: String(q),                    // label shown to the user\n    description: q === 1 ? '1 unit' : `${q} units`,\n    // id is a safe encoded JSON string (decode on webhook parse)\n    id: idObj\n  });\n}\n\n// Build output fields\nconst body = `${BODY_PREFIX} '${trunc(productTitle, 36)}'. How many units do you want?`;\nconst button = BUTTON_TEXT;\nconst items_stringified = JSON.stringify(items); // stringified JSON array as requested\n\nreturn [{\n  json: {\n    body,\n    button,\n    items_stringified\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -464,
        272
      ],
      "id": "65d80e60-876b-482a-ae6d-26cf9ad8bb46",
      "name": "list_quantity"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a0ea277a-b6fc-4818-8787-bae7b6768ddc",
              "name": "item_id",
              "value": "={{ $json.body.ListId.split('_')[1] }}",
              "type": "string"
            },
            {
              "id": "d331bf07-e522-4f03-8752-f7b332b1f648",
              "name": "quantity",
              "value": "={{ $json.body.ListTitle }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        80
      ],
      "id": "821ae4ab-89a3-40a7-a39f-6cc8cb2a923a",
      "name": "Get Item ID"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.item_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -240,
        80
      ],
      "id": "456f52c3-22f4-4350-84a9-fb7381c49bcf",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://content.twilio.com/v1/Content",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"friendly_name\": \"confirm_order\",\n  \"language\": \"en\",\n  \"types\": {\n    \"twilio/quick-reply\": {\n      \"body\": \"Confirm your order: \\n â€¢ Product: {{ $json.title }} \\n â€¢ Quantity: {{ $('Get Item ID').item.json.quantity }}\",\n      \"actions\": [\n        {\n          \"title\": \"Confirm\",\n          \"id\": \"confirm_{{ $('Get Item ID').item.json.item_id }}_{{ $('Get Item ID').item.json.quantity }}\"\n        },\n        {\n          \"title\": \"Cancel\",\n          \"id\": \"cancel\"\n        }\n      ]\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -16,
        80
      ],
      "id": "9d5a9e93-da3c-444f-9688-d3f2f5d11d30",
      "name": "Confirmation Template",
      "credentials": {
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $node['Webhook'].json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $node['Webhook'].json.body.To }}"
            },
            {
              "name": "ContentSid",
              "value": "={{ $json.sid }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        208,
        80
      ],
      "id": "b794c898-6ebd-4a3b-bbe0-0fc81e1d7b15",
      "name": "Send Confirm Template",
      "credentials": {
        "httpBasicAuth": {
          "id": "WsQzmrY4u3R3NvDi",
          "name": "Twillio cred 2"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $('Webhook').item.json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $('Webhook').item.json.body.To }}"
            },
            {
              "name": "ContentSid",
              "value": "HX67dec374c3290ba042afc2e69e75f8c1"
            },
            {
              "name": "ContentVariables",
              "value": "={\"1\":\"{{ $('Webhook').item.json.body.ProfileName }}\"}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -240,
        -112
      ],
      "id": "e4636f0d-3d9b-45f6-97b3-aea38371dda5",
      "name": "Send Initial Template1",
      "credentials": {
        "httpBasicAuth": {
          "id": "WsQzmrY4u3R3NvDi",
          "name": "Twillio cred 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $('Check if Template').item.json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $('Check if Template').item.json.body.To }}"
            },
            {
              "name": "Body",
              "value": "=Your Order Has Been Cancel\nIf you want inital menu, type \"Menu\""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -464,
        -112
      ],
      "id": "24d8d59c-5d24-4a4f-b3bf-29b9d67d305d",
      "name": "Send Normal Message",
      "credentials": {
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "00a9c062-dd4a-46e1-aca8-543cae3c6dca",
              "name": "item_id",
              "value": "={{ $json.body.ButtonPayload.split(\"_\")[1] }}",
              "type": "string"
            },
            {
              "id": "951c7c53-da08-4ec7-84f0-4bbc5433d52a",
              "name": "quantity",
              "value": "={{ $json.body.ButtonPayload.split(\"_\")[2] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -464,
        -496
      ],
      "id": "802434ea-635f-4c2c-9ed7-fbc60ff18135",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "id",
              "lookupValue": "={{ $json.item_id }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -240,
        -496
      ],
      "id": "831d592b-01b4-4ded-b349-7730aa3973f2",
      "name": "Get row(s) in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 38109468,
          "mode": "list",
          "cachedResultName": "Order List",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Phone Number": "={{ $('Webhook').item.json.body.WaId }}",
            "User": "={{ $('Webhook').item.json.body.ProfileName }}",
            "Item_id": "={{ $('Edit Fields').item.json.item_id }}",
            "Item": "={{ $json.title }}",
            "Quantity": "={{ $('Edit Fields').item.json.quantity }}",
            "Date": "={{ $now.setZone('Asia/Kolkata').format('yyyy-MM-dd T') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "User",
              "displayName": "User",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item_id",
              "displayName": "Item_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item",
              "displayName": "Item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Quantity",
              "displayName": "Quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -16,
        -496
      ],
      "id": "e63b5675-06e4-4c4e-a8e7-67c5190725cd",
      "name": "Append row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $('Check if Template').item.json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $('Check if Template').item.json.body.To }}"
            },
            {
              "name": "Body",
              "value": "=Your Order Has Been Added in our Database\nIf you want inital menu, type \"Menu\""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        208,
        -496
      ],
      "id": "85025d4d-0fe9-4a5e-b47d-41f4020ac3d2",
      "name": "Send Normal Message1",
      "credentials": {
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.twilio.com/2010-04-01/Accounts/AC512855366730e39b4a0857b16fb14f27/Messages.json",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "contentType": "form-urlencoded",
        "bodyParameters": {
          "parameters": [
            {
              "name": "To",
              "value": "={{ $('Check if Template').item.json.body.From }}"
            },
            {
              "name": "From",
              "value": "={{ $('Check if Template').item.json.body.To }}"
            },
            {
              "name": "Body",
              "value": "=This Feature is under Development\nIf you want inital menu, type \"Menu\""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -464,
        -304
      ],
      "id": "05d90907-b4dd-42b2-b517-7ba9771f87f4",
      "name": "Send Normal Message2",
      "credentials": {
        "httpBasicAuth": {
          "id": "r3Hp5Vy6qya7XL5n",
          "name": "Twillio Credential"
        }
      }
    },
    {
      "parameters": {
        "multipleMethods": true,
        "path": "whatsapp_alister",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1136,
        -1392
      ],
      "id": "3b0080ac-4b54-41c0-9f56-b71be5213c58",
      "name": "Whatsapp Bot Webhook",
      "webhookId": "2b7f85b2-f581-46d9-8d22-172f7a9933c0"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.query[\"hub.challenge\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -688,
        -1488
      ],
      "id": "cbef7959-d640-4f0e-9853-d51daa0d3ae9",
      "name": "Verify Webhook"
    },
    {
      "parameters": {
        "content": "# Twillio Connection",
        "height": 1184,
        "width": 1872
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1344,
        -752
      ],
      "id": "87410b3c-eef4-46ce-8088-a9442cac5d53",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51696ba9-54b9-4f8c-bd0c-4e11fcb50d45",
              "leftValue": "={{ $json.query['hub.mode'] }}",
              "rightValue": "subscribe",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "4b041959-0ee0-4db3-8465-d08554bdec80",
              "leftValue": "={{ $json.query['hub.verify_token'] }}",
              "rightValue": "hello",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -912,
        -1488
      ],
      "id": "25f8644c-99d4-4c89-b1c2-5f640181f41c",
      "name": "Check webhook configure parameter"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "24009ed9-9dd8-4b22-9e15-ef5b4e0b1587",
              "name": "msg_from",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.metadata.display_phone_number }}",
              "type": "string"
            },
            {
              "id": "2977f9b0-5df4-4d94-93a7-308724b31769",
              "name": "msg",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].text.body }}",
              "type": "string"
            },
            {
              "id": "14d7554a-9415-4478-b26c-59d88b63d498",
              "name": "user_name",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        -1104
      ],
      "id": "a09b5fad-edb8-44f0-b4f7-b9fb39ead618",
      "name": "Set Variable"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $('Add this Variable').item.json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"Hi {{ $json.user_name }} ðŸ‘‹ \\nWelcome to Butruu! You can:\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"browse_product\",\n            \"title\": \"Browse Product\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"order_status\",\n            \"title\": \"Order Status\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"ask_faq\",\n            \"title\": \"Ask FAQs\"\n          }\n        }\n      ]\n    }\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -16,
        -1104
      ],
      "id": "f78086e0-6261-45f0-a49d-108cd49c024e",
      "name": "HTTP Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "7Q2vsTXke5Mb8ehV",
          "name": "Mayank whatsapp"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "897fa65a-47b7-4e25-b472-6f72bfc1d1c5",
              "leftValue": "={{ $json.body.entry[0].changes[0].value.statuses[0].status }}",
              "rightValue": "read",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        -912,
        -1296
      ],
      "id": "854c4a0b-00d9-4bb9-a993-70a2e14f295b",
      "name": "Filter"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9ce7a61-a4ac-410d-a657-cc2043987041",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "confirm",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirm Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fe1e27ee-c64f-4431-95f9-bc69d2b64f40",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "order_status",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fa8a5bb5-2908-4bee-b7f7-b7d6cd329182",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "ask_faq",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ask FAQs"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ac966a0-815a-4c1b-9c9c-2af2834b903f",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "cancel",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancel Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "browse_product",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7c6ca04-7747-406d-ab76-cd29c0e07c09"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Browse Product"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -16,
        -1920
      ],
      "id": "c70792a6-7041-4dea-ae7c-48c3f761d8b8",
      "name": "Switch1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.type }}",
                    "rightValue": "button_reply",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "66f96ae4-4402-4323-8b49-2f569e97fbf3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Button Reply"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -240,
        -1872
      ],
      "id": "624d36cc-c55c-42fe-8460-17b6d6d18a4b",
      "name": "Interative Type Route"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1104,
        -1472
      ],
      "id": "dc6a9564-09b1-4a65-92e8-54638755f599",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Convert Excel rows â†’ PROPER JSON array ready for Twilio\nconst MAX_ITEMS = 10;\n  const TITLE_MAX = 24;\nconst DESC_MAX = 72;\n\nconst rows = $input.all().map(i => i.json);\n\nfunction trunc(s,n){ \n  if (!s) return \"\"; \n  s = String(s); \n  return s.length<=n ? s : s.slice(0,n-1)+\"â€¦\"; \n}\n\n// Order by in-stock first\nconst inStock = rows.filter(r => (r.availability || '').toLowerCase() === 'in stock');\nconst others   = rows.filter(r => !inStock.includes(r));\nconst ordered  = inStock.concat(others).slice(0, MAX_ITEMS);\n\n// Build Twilio List Picker items\nconst listItems = ordered.map(p => {\n  const id = String(p.id);\n  const title = trunc(p.title, TITLE_MAX);\n  const description = trunc(p.description ?? `â‚¹${p.price} â€¢ ${p.availability}`, DESC_MAX);\n  return {\n    product_retailer_id: id\n  };\n});\n\n// Return BOTH versions:\n// 1. Normal JSON array\n// 2. Stringified JSON array (for display)\nreturn [{\n  json: {\n    items: listItems,\n    items_stringified: JSON.stringify(listItems, null, 2)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        -1472
      ],
      "id": "7acc8374-6e8d-4a56-8fa7-fd6b4d34f56b",
      "name": "mapping_item1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1264,
        -2496
      ],
      "id": "3920186d-98df-4c94-a70d-2dfe84046c18",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $json.phone_number_id }}/business_compliance_info",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"entity_name\": \"Lakshit Ukani\",\n  \"entity_type\": \"SOLE_PROPRIETORSHIP\",\n  \"entity_registration_number\": \"AEEUU5907L\",\n  \"business_address\": {\n    \"street\": \"Mira road\",\n    \"city\": \"Thane\",\n    \"state\": \"Maharashtra\",\n    \"postal_code\": \"401107\",\n    \"country\": \"IN\"\n  },\n  \"customer_care_details\": {\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918163328947\"\n  },\n  \"grievance_officer_details\": {\n    \"name\": \"Lakshit Ukani\",\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918122228947\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -832,
        -2496
      ],
      "id": "ebd5a909-1e79-4d65-95c7-7c065ef022ed",
      "name": "Compliance Info Post",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v24.0/{{ $('Edit Fields3').item.json.phone_number_id }}/business_compliance_info",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -608,
        -2496
      ],
      "id": "bdcdd0f1-89d7-4ce2-96c6-4d5eb050b0d7",
      "name": "Compliance Info Get",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"product_list\",\n    \"header\": {\n      \"type\": \"text\",\n      \"text\": \"Baby Care Products\"\n    },\n    \"body\": {\n      \"text\": \"Check out our premium baby care collection\"\n    },\n    \"footer\": {\n      \"text\": \"Best prices guaranteed\"\n    },\n    \"action\": {\n      \"catalog_id\": \"896416602722897\",\n      \"sections\": [\n        {\n          \"title\": \"Diapers & Care\",\n          \"product_items\": \n            {{ JSON.stringify($json.items) }}\n        }\n      ]\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1584,
        -1472
      ],
      "id": "849339c9-93a5-4fce-9e4e-8a47847af47f",
      "name": "Send Multi Product Template",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "interactive",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38c2ee1e-5380-4c4c-906a-765cd35fff09"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Interactive"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7bb670b9-8110-4d70-a382-9581cd025551",
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "order",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "73114ba1-f1c6-4eb8-8f92-f9abf6d6cb29",
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -464,
        -1312
      ],
      "id": "90f57056-7240-4358-97bb-98ea291c9819",
      "name": "Message Type Routing"
    },
    {
      "parameters": {
        "content": "# Compliance Check for India",
        "height": 304,
        "width": 944
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1312,
        -2624
      ],
      "id": "f223e2b6-f285-458b-a300-a473b5a6840e",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -16,
        -1296
      ],
      "id": "9e36b115-9bd8-40d0-8800-a546b2f7d9e1",
      "name": "Get Stock data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Input 1 = WhatsApp webhook\n// Input 2 = Excel data\n\n// FIX 1: unwrap Excel rows from .all() â†’ each item is { json: { ... } }\nconst excelData = $('Get Stock data').all().map(item => item.json);\n\n// Extract all product_items from WhatsApp order\nconst productItems = $('Whatsapp Bot Webhook').first().json.body.entry[0].changes[0].value.messages[0].order.product_items\n\n// Collect errors\nlet errors = [];\n\nfor (const item of productItems) {\n  const selectedId = String(item.product_retailer_id).trim();\n  const selectedQty = Number(item.quantity);\n\n  // FIX 2: normalize Excel IDs to string\n  const match = excelData.find(p => String(p.id).trim() === selectedId);\n\n  if (!match) {\n    errors.push(`Product with ID ${selectedId} not found.`);\n    continue;\n  }\n\n  const available = Number(match.item_available);\n\n  if (available < selectedQty) {\n    errors.push(\n      `Only ${available} item(s) of \"${match.title}\" are available, but you selected ${selectedQty}.`\n    );\n  }\n}\n\n// FINAL DECISION\nif (errors.length === 0) {\n  return [\n    {\n      json: {\n        success: true,\n        message: \"Stock available for all selected items.\"\n      }\n    }\n  ];\n} else {\n  return [\n    {\n      json: {\n        success: false,\n        message: errors.join(\" | \")\n      }\n    }\n  ];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        -1296
      ],
      "id": "fadea261-f7b7-4a7a-a9a0-9945c48c2d3b",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd52bbe8-7f92-4efe-8416-0d8d14246800",
              "name": "=msg_to_send",
              "value": "=Thanks for your order! ðŸ˜„\nI checked the availability and hereâ€™s an update:\n\nSome items are currently not available in the quantity you selected:\n\nðŸ‘‰ {{$json.message.replace(/\\|/g, \"\\nðŸ‘‰ \")}}\n\nYou can update the quantities and let me know â€” Iâ€™ll place the order immediately for you!;",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        656,
        -1392
      ],
      "id": "a21bd904-3062-4a8e-b076-5459573efcab",
      "name": "Error message"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "018b7715-2bfd-48f9-b1da-63fb9b6209f0",
              "name": "msg_to_send",
              "value": "=Hey! ðŸ˜Š\nI checked the items you added to your cart.\n\nGood news: Everything you selected is in stock and ready to go!\nPlease confirm your order to continue.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        656,
        -1200
      ],
      "id": "858526bc-1fd7-4fa8-9060-8f0736341436",
      "name": "Succes Msg"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $node['Add this Variable'].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"{{ $json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        880,
        -1392
      ],
      "id": "709cbadb-6a1f-445e-9e57-dfb1d78e99fc",
      "name": "Send msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
              "name": "catalog_id",
              "value": "896416602722897",
              "type": "string"
            },
            {
              "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
              "name": "msg_to",
              "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        -1296
      ],
      "id": "19db4f36-eb24-4f79-8088-75ca4359b201",
      "name": "Set Variable2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"{{ $('Succes Msg').item.json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_confirm\",\n            \"title\": \"Confirm\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_cancel\",\n            \"title\": \"Cancel\"\n          }\n        }\n      ]\n    }\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2000,
        -1200
      ],
      "id": "f866cafb-23fd-4de5-adaf-7767a791dc7e",
      "name": "HTTP Request2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "htaS8wafCR4Eh7v5",
          "mode": "list",
          "cachedResultName": "Alister Order Stage",
          "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "phone_no": "={{ $('Edit Fields1').item.json.user_phone_no }}",
            "unique_order_id": "={{ $('Edit Fields1').item.json.unique_id_of_order }}",
            "user_name": "={{ $('Edit Fields1').item.json.user_name }}",
            "product_id": "={{ $json.product_retailer_id }}",
            "product_quantity": "={{ $json.quantity }}",
            "product_title": "={{ $json.title }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "unique_order_id",
              "displayName": "unique_order_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "user_name",
              "displayName": "user_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone_no",
              "displayName": "phone_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_id",
              "displayName": "product_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_title",
              "displayName": "product_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_quantity",
              "displayName": "product_quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1552,
        -1200
      ],
      "id": "d9d4a636-5253-4e91-a6c5-5d58c5f78603",
      "name": "Insert row"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c618dbc9-40d0-4cd6-b164-60a462ceb16e",
              "name": "user_selected_product",
              "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].order.product_items }}",
              "type": "array"
            },
            {
              "id": "41163f52-519c-4a26-8f60-c5cbb759a21c",
              "name": "unique_id_of_order",
              "value": "={{ 'ORD-' + Date.now() + '-' + Math.floor(Math.random() * 10000) }}",
              "type": "string"
            },
            {
              "id": "21053b3f-1909-4bb3-9888-561355df41bc",
              "name": "user_name",
              "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "36d108e7-b62c-4145-822c-640f588557a9",
              "name": "user_phone_no",
              "value": "={{ $node['Add this Variable'].json.msg_to }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        -1200
      ],
      "id": "ce22c39a-584d-4009-9823-9e2c90b73042",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "user_selected_product",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1104,
        -1200
      ],
      "id": "55feeac7-55bd-42e7-b37b-e644d5f82de8",
      "name": "Split Out"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b414d52e-386d-4c0e-8eac-d0aeb8135ad6",
              "name": "order_id",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id.split(\"_\")[0] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        208,
        -2256
      ],
      "id": "77391d16-7abe-44e2-861f-3b1245a6b7ca",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 38109468,
          "mode": "list",
          "cachedResultName": "Order List",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Phone Number": "={{ $json.phone_no }}",
            "User": "={{ $json.user_name }}",
            "Item_id": "={{ $json.product_id }}",
            "Item": "={{ $json.product_title }}",
            "Quantity": "={{ $json.product_quantity }}",
            "Date": "={{ $now.setZone('Asia/Kolkata').format('yyyy-MM-dd T') }}",
            "Status": "Order Placed",
            "Order ID": "={{ $('Edit Fields2').item.json.order_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Order ID",
              "displayName": "Order ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "User",
              "displayName": "User",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item_id",
              "displayName": "Item_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item",
              "displayName": "Item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Quantity",
              "displayName": "Quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        656,
        -2256
      ],
      "id": "37935ec5-dd12-4f55-a396-fb06e19f56b8",
      "name": "Append row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "htaS8wafCR4Eh7v5",
          "mode": "list",
          "cachedResultName": "Alister Order Stage",
          "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "unique_order_id",
              "keyValue": "={{ $('Edit Fields2').item.json.order_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        432,
        -2256
      ],
      "id": "da314ca5-c1d0-4d96-847d-2c08dc5135b6",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "263eb8a1-0b0b-4e98-bede-2ca52dc566ed",
              "leftValue": "={{ $json.success }}",
              "rightValue": "false",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        432,
        -1296
      ],
      "id": "4939cfcd-6a1c-4eef-98c8-bf30a5a1cf64",
      "name": "If Stock is available"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1776,
        -1200
      ],
      "id": "740ad203-809c-4465-819f-3c7acd6e5423",
      "name": "Limit"
    },
    {
      "parameters": {
        "jsCode": "// Load data from nodes\nconst product_data = $(\"Get Stock data\").all().map(item => item.json);\nconst user_selected_data = $(\"Split Out\").all().map(item => item.json);\n\n// Final output list\nlet matched = [];\n\n// Loop through user-selected items\nfor (const userItem of user_selected_data) {\n  \n  const selectedId = String(userItem.product_retailer_id).trim();\n\n  // Find matching product from stock data\n  const stockItem = product_data.find(\n    p => String(p.id).trim() === selectedId\n  );\n\n  // If matched â†’ append combined data\n  if (stockItem) {\n    matched.push({\n      product_retailer_id: selectedId,\n      title: stockItem.title,\n      quantity: userItem.quantity\n    });\n  }\n}\n\n// Return result\nreturn matched.map(m => ({ json: m }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        -1200
      ],
      "id": "23c6658a-0f49-44a5-818c-4f68d23f4dc6",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order has been placed and we will deliver soon\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1104,
        -2256
      ],
      "id": "26831b99-253a-4d91-bb01-8ff8dac0aa6c",
      "name": "Send msg1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        880,
        -2256
      ],
      "id": "e019d711-350a-4ef3-9289-777833978fea",
      "name": "Limit1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order Has Been Cancel \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        208,
        -1680
      ],
      "id": "fce3578c-ad98-453a-9724-bffc0d0a557a",
      "name": "Cancel Msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"This Feature is under Development \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        208,
        -1872
      ],
      "id": "8634bc0f-b143-483a-b612-3006fb7e0c7e",
      "name": "FAQ msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "content": "# Official Meta Connection",
        "height": 1392,
        "width": 3536
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1312,
        -2288
      ],
      "id": "04990b98-2e8f-4b62-96e5-079c07492537",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 38109468,
          "mode": "list",
          "cachedResultName": "Order List",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Phone Number",
              "lookupValue": "={{ $json.msg_to }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        208,
        -2064
      ],
      "id": "f4d4b147-8b53-4546-b541-a65c87900240",
      "name": "Get row(s) in sheet4",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Load orders from sheet4\nconst order_list = $(\"Get row(s) in sheet4\").all().map(item => item.json);\n\n// If empty\nif (!order_list.length) {\n  return [{ json: { message: \"You have no orders at the moment.\" } }];\n}\n\n// Group by Order ID\nconst grouped = {};\n\nfor (const row of order_list) {\n  const orderId = row[\"Order ID\"];\n\n  if (!grouped[orderId]) {\n    grouped[orderId] = {\n      items: [],\n      status: row.Status,\n    };\n  }\n\n  grouped[orderId].items.push({\n    item: row.Item,\n    quantity: row.Quantity,\n  });\n}\n\n// Build the message\nlet msg = \"ðŸ“¦ *Your Order Summary*\\n\\nHereâ€™s a quick overview of all your recent orders:\\n\\n\";\n\nfor (const [orderId, data] of Object.entries(grouped)) {\n  const totalQty = data.items.reduce((sum, i) => sum + Number(i.quantity), 0);\n\n  msg += `ðŸ§¾ *Order ID:* ${orderId}\\n`;\n  msg += `ðŸ“¦ *Total Items:* ${totalQty}\\n`;\n  msg += `ðŸ“Œ *Status:* ${data.status}\\n`;\n  msg += `ðŸ›ï¸ *Items:*\\n`;\n\n  for (const item of data.items) {\n    msg += `   â€¢ ${item.item} Ã—${item.quantity}\\n`;\n  }\n\n  msg += `\\n`;\n}\n\n// msg += \"ðŸ’¬ If you'd like to *track*, *change*, or *cancel* any order, just reply with the Order ID (e.g., *ORD-1764326177122-8178*).\";\n\n// Return final message\nreturn [{ json: { message: msg } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        432,
        -2064
      ],
      "id": "a805b8ff-a0ef-4152-8786-a58c63dde7e6",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": {{ JSON.stringify($json.message) }}\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        656,
        -2064
      ],
      "id": "df8f3936-f6e8-4e3f-9cbd-df5170cf6918",
      "name": "Send msg2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://graph.facebook.com/v24.0/924412964080974/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\":\"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\":\"918655991300\",\n  \"type\":\"interactive\",\n  \"interactive\":{\n    \"type\":\"product\",\n    \"body\": {\n      \"text\":\"Check this item\" \n    },\n    \"footer\": { \n      \"text\":\"Tap to view details\" \n    },\n    \"action\": {\n      \"catalog_id\":\"896416602722897\",\n      \"product_retailer_id\":\"1\"\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2288,
        -1824
      ],
      "id": "e6602605-cca6-44ec-bbff-213ef4033fb6",
      "name": "HTTP Request5",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
              "name": "catalog_id",
              "value": "896416602722897",
              "type": "string"
            },
            {
              "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
              "name": "msg_to",
              "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "bafa1b69-5374-4c42-ac6c-766dab6487e3",
              "name": "phone_number_id",
              "value": "924412964080974",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -688,
        -1296
      ],
      "id": "79a6392e-4a87-4d62-8c0c-fd61ce3b9768",
      "name": "Add this Variable"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "528835a6-bfc1-4ef6-88da-fab4dfda48df",
              "name": "phone_number_id",
              "value": "924412964080974",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1056,
        -2496
      ],
      "id": "993077bb-206f-4ef4-84c6-01aea9c78488",
      "name": "Edit Fields3"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Check if Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Template": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Initial Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "mapping_item",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create List picker template OG": {
      "main": [
        [
          {
            "node": "Send Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mapping_item": {
      "main": [
        [
          {
            "node": "Create List picker template OG",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Normal Message2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Normal Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Item ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "list_quantity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create List Quantity picker ": {
      "main": [
        [
          {
            "node": "Send Quantity Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "list_quantity": {
      "main": [
        [
          {
            "node": "Create List Quantity picker ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Item ID": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Confirmation Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirmation Template": {
      "main": [
        [
          {
            "node": "Send Confirm Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Normal Message": {
      "main": [
        [
          {
            "node": "Send Initial Template1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Send Normal Message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Whatsapp Bot Webhook": {
      "main": [
        [
          {
            "node": "Check webhook configure parameter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check webhook configure parameter": {
      "main": [
        [
          {
            "node": "Verify Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variable": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Initial Template": {
      "main": [
        []
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Add this Variable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interative Type Route": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "mapping_item1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FAQ msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancel Msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compliance Info Post": {
      "main": [
        [
          {
            "node": "Compliance Info Get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Multi Product Template": {
      "main": [
        []
      ]
    },
    "mapping_item1": {
      "main": [
        [
          {
            "node": "Send Multi Product Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message Type Routing": {
      "main": [
        [
          {
            "node": "Interative Type Route",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Variable2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Variable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stock data": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If Stock is available",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error message": {
      "main": [
        [
          {
            "node": "Send msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variable2": {
      "main": [
        [
          {
            "node": "Get Stock data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send msg": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Succes Msg": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        []
      ]
    },
    "Insert row": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Append row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Stock is available": {
      "main": [
        [
          {
            "node": "Error message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Succes Msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet2": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Send msg1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet4": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send msg2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add this Variable": {
      "main": [
        [
          {
            "node": "Message Type Routing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Compliance Info Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "024b05ad-170a-4667-8ebf-129675eefa0d",
  "activeVersionId": null,
  "triggerCount": 2,
  "shared": [
    {
      "updatedAt": "2025-11-13T11:34:53.842Z",
      "createdAt": "2025-11-13T11:34:53.842Z",
      "role": "workflow:owner",
      "workflowId": "V1GolwUDxcGbl6aY",
      "projectId": "iOyc3VpWKvgHH9fv"
    }
  ],
  "activeVersion": null,
  "tags": [
    {
      "updatedAt": "2025-11-14T10:19:51.673Z",
      "createdAt": "2025-11-14T10:19:51.673Z",
      "id": "ZeV32hHhoNphIlCK",
      "name": "mayank"
    }
  ]
}
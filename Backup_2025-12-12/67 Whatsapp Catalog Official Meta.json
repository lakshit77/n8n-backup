{
  "updatedAt": "2025-12-09T13:09:46.000Z",
  "createdAt": "2025-11-28T12:40:37.488Z",
  "id": "iH9rV8O93cjKMPM4",
  "name": "67 Whatsapp Catalog Official Meta",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "multipleMethods": true,
        "path": "whatsapp_catalog",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        1024,
        1296
      ],
      "id": "ad97b315-4e85-4490-9d0f-3182ab272887",
      "name": "Whatsapp Bot Webhook",
      "webhookId": "2b7f85b2-f581-46d9-8d22-172f7a9933c0"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{ $json.query[\"hub.challenge\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1472,
        1200
      ],
      "id": "160c6dcf-a237-4b85-9d26-18efef956629",
      "name": "Verify Webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "51696ba9-54b9-4f8c-bd0c-4e11fcb50d45",
              "leftValue": "={{ $json.query['hub.mode'] }}",
              "rightValue": "subscribe",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "4b041959-0ee0-4db3-8465-d08554bdec80",
              "leftValue": "={{ $json.query['hub.verify_token'] }}",
              "rightValue": "hello",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1248,
        1200
      ],
      "id": "e17cb01c-0348-46c0-8341-a5970ef51909",
      "name": "Check webhook configure parameter"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "24009ed9-9dd8-4b22-9e15-ef5b4e0b1587",
              "name": "msg_from",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.metadata.display_phone_number }}",
              "type": "string"
            },
            {
              "id": "2977f9b0-5df4-4d94-93a7-308724b31769",
              "name": "msg",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].text.body }}",
              "type": "string"
            },
            {
              "id": "14d7554a-9415-4478-b26c-59d88b63d498",
              "name": "user_name",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1920,
        1584
      ],
      "id": "a0622de7-dab1-45cb-a5f6-7a6be5f3dda9",
      "name": "Set Variable"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $('Add this Variable').item.json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"Hi {{ $json.user_name }} üëã \\nWelcome to Alister Bharat! You can:\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"browse_product\",\n            \"title\": \"Browse Product\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"order_status\",\n            \"title\": \"Order Status\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"ask_faq\",\n            \"title\": \"Ask FAQs\"\n          }\n        }\n      ]\n    }\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2144,
        1584
      ],
      "id": "f8d9ccc1-0aac-45b2-b762-3750729e6a86",
      "name": "HTTP Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "dMqgWEck6HIFxDk2",
          "name": "wa-agent app"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "897fa65a-47b7-4e25-b472-6f72bfc1d1c5",
              "leftValue": "={{ $json.body.entry[0].changes[0].value.statuses[0].status }}",
              "rightValue": "read",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        1248,
        1392
      ],
      "id": "bb03b50b-5eb6-4368-bfc7-9daf1c74c7de",
      "name": "Filter"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9ce7a61-a4ac-410d-a657-cc2043987041",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "confirm",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirm Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fe1e27ee-c64f-4431-95f9-bc69d2b64f40",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "order_status",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fa8a5bb5-2908-4bee-b7f7-b7d6cd329182",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "ask_faq",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ask FAQs"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ac966a0-815a-4c1b-9c9c-2af2834b903f",
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "cancel",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancel Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                    "rightValue": "browse_product",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a7c6ca04-7747-406d-ab76-cd29c0e07c09"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Browse Product"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        2144,
        768
      ],
      "id": "7bfcfb44-2fe1-48ca-b1c2-6646c9852034",
      "name": "Switch1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.type }}",
                    "rightValue": "button_reply",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "66f96ae4-4402-4323-8b49-2f569e97fbf3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Button Reply"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1920,
        816
      ],
      "id": "455d68a6-b636-4059-bd9b-d1e7e1e5d966",
      "name": "Interative Type Route"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3264,
        1216
      ],
      "id": "287206a1-b9fa-450e-a0a0-0579f5f933bd",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Convert Excel rows ‚Üí PROPER JSON array ready for Twilio\nconst MAX_ITEMS = 10;\n  const TITLE_MAX = 24;\nconst DESC_MAX = 72;\n\nconst rows = $input.all().map(i => i.json);\n\nfunction trunc(s,n){ \n  if (!s) return \"\"; \n  s = String(s); \n  return s.length<=n ? s : s.slice(0,n-1)+\"‚Ä¶\"; \n}\n\n// Order by in-stock first\nconst inStock = rows.filter(r => (r.availability || '').toLowerCase() === 'in stock');\nconst others   = rows.filter(r => !inStock.includes(r));\nconst ordered  = inStock.concat(others).slice(0, MAX_ITEMS);\n\n// Build Twilio List Picker items\nconst listItems = ordered.map(p => {\n  const id = String(p.id);\n  const title = trunc(p.title, TITLE_MAX);\n  const description = trunc(p.description ?? `‚Çπ${p.price} ‚Ä¢ ${p.availability}`, DESC_MAX);\n  return {\n    product_retailer_id: id\n  };\n});\n\n// Return BOTH versions:\n// 1. Normal JSON array\n// 2. Stringified JSON array (for display)\nreturn [{\n  json: {\n    items: listItems,\n    items_stringified: JSON.stringify(listItems, null, 2)\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3488,
        1216
      ],
      "id": "368e9667-6ffe-4738-8278-2a3653d6904a",
      "name": "mapping_item1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        896,
        192
      ],
      "id": "6dd09c4f-adc8-4aee-bd9c-d7409b7a571a",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $json.phone_number_id }}/business_compliance_info",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"entity_name\": \"Lakshit Ukani\",\n  \"entity_type\": \"SOLE_PROPRIETORSHIP\",\n  \"entity_registration_number\": \"AEEUU5907L\",\n  \"business_address\": {\n    \"street\": \"Mira road\",\n    \"city\": \"Thane\",\n    \"state\": \"Maharashtra\",\n    \"postal_code\": \"401107\",\n    \"country\": \"IN\"\n  },\n  \"customer_care_details\": {\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918163328947\"\n  },\n  \"grievance_officer_details\": {\n    \"name\": \"Lakshit Ukani\",\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918122228947\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1328,
        192
      ],
      "id": "e05dabcd-efdf-4ae1-97b6-6393a711126c",
      "name": "Compliance Info Post",
      "credentials": {
        "httpHeaderAuth": {
          "id": "dMqgWEck6HIFxDk2",
          "name": "wa-agent app"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://graph.facebook.com/v24.0/{{ $('Edit Fields3').item.json.phone_number_id }}/business_compliance_info",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1552,
        192
      ],
      "id": "c93671a6-9656-4c8c-8a4e-fc7242a62272",
      "name": "Compliance Info Get",
      "credentials": {
        "httpHeaderAuth": {
          "id": "dMqgWEck6HIFxDk2",
          "name": "wa-agent app"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"product_list\",\n    \"header\": {\n      \"type\": \"text\",\n      \"text\": \"Baby Care Products\"\n    },\n    \"body\": {\n      \"text\": \"Check out our premium baby care collection\"\n    },\n    \"footer\": {\n      \"text\": \"Best prices guaranteed\"\n    },\n    \"action\": {\n      \"catalog_id\": \"896416602722897\",\n      \"sections\": [\n        {\n          \"title\": \"Diapers & Care\",\n          \"product_items\": \n            {{ JSON.stringify($json.items) }}\n        }\n      ]\n    }\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3744,
        1216
      ],
      "id": "118758f2-9368-425a-8adf-7bf40603e171",
      "name": "Send Multi Product Template",
      "credentials": {
        "httpHeaderAuth": {
          "id": "dMqgWEck6HIFxDk2",
          "name": "wa-agent app"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "interactive",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "38c2ee1e-5380-4c4c-906a-765cd35fff09"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Interactive"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7bb670b9-8110-4d70-a382-9581cd025551",
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "order",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Order"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "73114ba1-f1c6-4eb8-8f92-f9abf6d6cb29",
                    "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        1696,
        1376
      ],
      "id": "02c980ef-89d7-4d6f-a5e8-e14eb5ef45fc",
      "name": "Message Type Routing"
    },
    {
      "parameters": {
        "content": "# Compliance Check for India",
        "height": 304,
        "width": 944
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        848,
        64
      ],
      "id": "10fe7dc9-fbef-4209-8aba-ecb4cde2f9dd",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1401568257,
          "mode": "list",
          "cachedResultName": "demo sheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2144,
        1392
      ],
      "id": "0322421b-dbf7-49e2-9a42-a30ebab8a2c2",
      "name": "Get Stock data",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Input 1 = WhatsApp webhook\n// Input 2 = Excel data\n\n// FIX 1: unwrap Excel rows from .all() ‚Üí each item is { json: { ... } }\nconst excelData = $('Get Stock data').all().map(item => item.json);\n\n// Extract all product_items from WhatsApp order\nconst productItems = $('Whatsapp Bot Webhook').first().json.body.entry[0].changes[0].value.messages[0].order.product_items\n\n// Collect errors\nlet errors = [];\n\nfor (const item of productItems) {\n  const selectedId = String(item.product_retailer_id).trim();\n  const selectedQty = Number(item.quantity);\n\n  // FIX 2: normalize Excel IDs to string\n  const match = excelData.find(p => String(p.id).trim() === selectedId);\n\n  if (!match) {\n    errors.push(`Product with ID ${selectedId} not found.`);\n    continue;\n  }\n\n  const available = Number(match.item_available);\n\n  if (available < selectedQty) {\n    errors.push(\n      `Only ${available} item(s) of \"${match.title}\" are available, but you selected ${selectedQty}.`\n    );\n  }\n}\n\n// FINAL DECISION\nif (errors.length === 0) {\n  return [\n    {\n      json: {\n        success: true,\n        message: \"Stock available for all selected items.\"\n      }\n    }\n  ];\n} else {\n  return [\n    {\n      json: {\n        success: false,\n        message: errors.join(\" | \")\n      }\n    }\n  ];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2368,
        1392
      ],
      "id": "db4b4d17-0669-4b58-95f7-afe2b007a820",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd52bbe8-7f92-4efe-8416-0d8d14246800",
              "name": "=msg_to_send",
              "value": "=Thanks for your order! üòÑ\nI checked the availability and here‚Äôs an update:\n\nSome items are currently not available in the quantity you selected:\n\nüëâ {{$json.message.replace(/\\|/g, \"\\nüëâ \")}}\n\nYou can update the quantities and let me know ‚Äî I‚Äôll place the order immediately for you!;",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2816,
        1296
      ],
      "id": "1645cfd9-e5af-4478-9d31-a1401db92330",
      "name": "Error message"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "018b7715-2bfd-48f9-b1da-63fb9b6209f0",
              "name": "msg_to_send",
              "value": "=Hey! üòä\nI checked the items you added to your cart.\n\nGood news: Everything you selected is in stock and ready to go!\nPlease confirm your order to continue.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2816,
        1488
      ],
      "id": "ef060747-6287-4e4d-81ca-6282b5ff9544",
      "name": "Succes Msg"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $node['Add this Variable'].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"{{ $json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3040,
        1296
      ],
      "id": "f69be331-45d6-4be1-848a-e0a7ea5ffc36",
      "name": "Send msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
              "name": "catalog_id",
              "value": "896416602722897",
              "type": "string"
            },
            {
              "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
              "name": "msg_to",
              "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1920,
        1392
      ],
      "id": "1ec2b121-697c-47ed-8057-0ed031d92b69",
      "name": "Set Variable2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"{{ $('Succes Msg').item.json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_confirm\",\n            \"title\": \"Confirm\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_cancel\",\n            \"title\": \"Cancel\"\n          }\n        }\n      ]\n    }\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        4160,
        1488
      ],
      "id": "a7ca8060-bf83-49ea-bd2e-0a56188b05be",
      "name": "HTTP Request2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "htaS8wafCR4Eh7v5",
          "mode": "list",
          "cachedResultName": "Alister Order Stage",
          "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "phone_no": "={{ $('Edit Fields1').item.json.user_phone_no }}",
            "unique_order_id": "={{ $('Edit Fields1').item.json.unique_id_of_order }}",
            "user_name": "={{ $('Edit Fields1').item.json.user_name }}",
            "product_id": "={{ $json.product_retailer_id }}",
            "product_quantity": "={{ $json.quantity }}",
            "product_title": "={{ $json.title }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "unique_order_id",
              "displayName": "unique_order_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "user_name",
              "displayName": "user_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone_no",
              "displayName": "phone_no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_id",
              "displayName": "product_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_title",
              "displayName": "product_title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "product_quantity",
              "displayName": "product_quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        3712,
        1488
      ],
      "id": "b7e17d1f-b0fc-479c-8d7f-8ef6dcb442a1",
      "name": "Insert row"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c618dbc9-40d0-4cd6-b164-60a462ceb16e",
              "name": "user_selected_product",
              "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].order.product_items }}",
              "type": "array"
            },
            {
              "id": "41163f52-519c-4a26-8f60-c5cbb759a21c",
              "name": "unique_id_of_order",
              "value": "={{ 'ORD-' + Date.now() + '-' + Math.floor(Math.random() * 10000) }}",
              "type": "string"
            },
            {
              "id": "21053b3f-1909-4bb3-9888-561355df41bc",
              "name": "user_name",
              "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
              "type": "string"
            },
            {
              "id": "36d108e7-b62c-4145-822c-640f588557a9",
              "name": "user_phone_no",
              "value": "={{ $node['Add this Variable'].json.msg_to }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3040,
        1488
      ],
      "id": "489e65b0-1670-48b4-889d-b73e76ed1ddc",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "fieldToSplitOut": "user_selected_product",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        3264,
        1488
      ],
      "id": "248d45a0-08b9-4521-8479-dd6cf8a756b1",
      "name": "Split Out"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b414d52e-386d-4c0e-8eac-d0aeb8135ad6",
              "name": "order_id",
              "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id.split(\"_\")[0] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2368,
        432
      ],
      "id": "e1e3a5a9-7059-4677-801f-354879769e99",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 38109468,
          "mode": "list",
          "cachedResultName": "Order List",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Phone Number": "={{ $json.phone_no }}",
            "User": "={{ $json.user_name }}",
            "Item_id": "={{ $json.product_id }}",
            "Item": "={{ $json.product_title }}",
            "Quantity": "={{ $json.product_quantity }}",
            "Date": "={{ $now.setZone('Asia/Kolkata').format('yyyy-MM-dd T') }}",
            "Status": "Order Placed",
            "Order ID": "={{ $('Edit Fields2').item.json.order_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Order ID",
              "displayName": "Order ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phone Number",
              "displayName": "Phone Number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "User",
              "displayName": "User",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item_id",
              "displayName": "Item_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Item",
              "displayName": "Item",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Quantity",
              "displayName": "Quantity",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2816,
        432
      ],
      "id": "21c940fd-4713-440b-b35f-008254bfbeb3",
      "name": "Append row in sheet2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "htaS8wafCR4Eh7v5",
          "mode": "list",
          "cachedResultName": "Alister Order Stage",
          "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "unique_order_id",
              "keyValue": "={{ $('Edit Fields2').item.json.order_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        2592,
        432
      ],
      "id": "af4b658b-7687-4d14-af63-ecbb09bb15d2",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "263eb8a1-0b0b-4e98-bede-2ca52dc566ed",
              "leftValue": "={{ $json.success }}",
              "rightValue": "false",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2592,
        1392
      ],
      "id": "cf743aae-cb26-4a5d-9bbd-61b5b58c4b0b",
      "name": "If Stock is available"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        3936,
        1488
      ],
      "id": "f0aa58a5-feef-41f6-bb52-5e4c4f1712b2",
      "name": "Limit"
    },
    {
      "parameters": {
        "jsCode": "// Load data from nodes\nconst product_data = $(\"Get Stock data\").all().map(item => item.json);\nconst user_selected_data = $(\"Split Out\").all().map(item => item.json);\n\n// Final output list\nlet matched = [];\n\n// Loop through user-selected items\nfor (const userItem of user_selected_data) {\n  \n  const selectedId = String(userItem.product_retailer_id).trim();\n\n  // Find matching product from stock data\n  const stockItem = product_data.find(\n    p => String(p.id).trim() === selectedId\n  );\n\n  // If matched ‚Üí append combined data\n  if (stockItem) {\n    matched.push({\n      product_retailer_id: selectedId,\n      title: stockItem.title,\n      quantity: userItem.quantity\n    });\n  }\n}\n\n// Return result\nreturn matched.map(m => ({ json: m }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3488,
        1488
      ],
      "id": "a9a0961d-e130-4d00-9d99-ffc68802907c",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order has been placed and we will deliver soon\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        3264,
        432
      ],
      "id": "39e9c19c-304f-41ea-bef6-3f37f1b73458",
      "name": "Send msg1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        3040,
        432
      ],
      "id": "b908c38c-cdfd-41ec-a692-a9a9b3f30a00",
      "name": "Limit1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order Has Been Cancel \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2368,
        1008
      ],
      "id": "a7e2b8fe-e521-49d4-bd33-9f36d1f86931",
      "name": "Cancel Msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"This Feature is under Development \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2368,
        816
      ],
      "id": "a5274428-c8cd-41c4-bea8-9f8cc57b66df",
      "name": "FAQ msg",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "content": "# Official Meta Connection",
        "height": 1392,
        "width": 3536
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        848,
        400
      ],
      "id": "2aeec772-8a5d-4b22-ac49-81f502fe8e98",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
          "mode": "list",
          "cachedResultName": "catalog_products",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 38109468,
          "mode": "list",
          "cachedResultName": "Order List",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Phone Number",
              "lookupValue": "={{ $json.msg_to }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2368,
        624
      ],
      "id": "466f6194-c6c8-40a8-999b-3e3a6ec66645",
      "name": "Get row(s) in sheet4",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cZc9FZPSLRtIq9IL",
          "name": "Lakshit77 Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Load orders from sheet4\nconst order_list = $(\"Get row(s) in sheet4\").all().map(item => item.json);\n\n// If empty\nif (!order_list.length) {\n  return [{ json: { message: \"You have no orders at the moment.\" } }];\n}\n\n// Group by Order ID\nconst grouped = {};\n\nfor (const row of order_list) {\n  const orderId = row[\"Order ID\"];\n\n  if (!grouped[orderId]) {\n    grouped[orderId] = {\n      items: [],\n      status: row.Status,\n    };\n  }\n\n  grouped[orderId].items.push({\n    item: row.Item,\n    quantity: row.Quantity,\n  });\n}\n\n// Build the message\nlet msg = \"üì¶ *Your Order Summary*\\n\\nHere‚Äôs a quick overview of all your recent orders:\\n\\n\";\n\nfor (const [orderId, data] of Object.entries(grouped)) {\n  const totalQty = data.items.reduce((sum, i) => sum + Number(i.quantity), 0);\n\n  msg += `üßæ *Order ID:* ${orderId}\\n`;\n  msg += `üì¶ *Total Items:* ${totalQty}\\n`;\n  msg += `üìå *Status:* ${data.status}\\n`;\n  msg += `üõçÔ∏è *Items:*\\n`;\n\n  for (const item of data.items) {\n    msg += `   ‚Ä¢ ${item.item} √ó${item.quantity}\\n`;\n  }\n\n  msg += `\\n`;\n}\n\n// msg += \"üí¨ If you'd like to *track*, *change*, or *cancel* any order, just reply with the Order ID (e.g., *ORD-1764326177122-8178*).\";\n\n// Return final message\nreturn [{ json: { message: msg } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2592,
        624
      ],
      "id": "cec5408f-0867-43a6-9754-a3216579a337",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": {{ JSON.stringify($json.message) }}\n  }\n}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2816,
        624
      ],
      "id": "fbb4dd26-2ef4-42d9-9826-8f4285051052",
      "name": "Send msg2",
      "credentials": {
        "httpHeaderAuth": {
          "id": "iR5q4Pc809XWa04V",
          "name": "whatsapp wa-agent-alister app Lakshit"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
              "name": "catalog_id",
              "value": "1877812469777617",
              "type": "string"
            },
            {
              "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
              "name": "msg_to",
              "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
              "type": "string"
            },
            {
              "id": "bafa1b69-5374-4c42-ac6c-766dab6487e3",
              "name": "phone_number_id",
              "value": "924412964080974",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1472,
        1392
      ],
      "id": "e35c5e1d-5836-462b-bbbf-879871ba840f",
      "name": "Add this Variable"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "528835a6-bfc1-4ef6-88da-fab4dfda48df",
              "name": "phone_number_id",
              "value": "924412964080974",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1104,
        192
      ],
      "id": "beb4704f-b312-4c40-bfbb-88fd7dd85fb9",
      "name": "Edit Fields3"
    }
  ],
  "connections": {
    "Whatsapp Bot Webhook": {
      "main": [
        [
          {
            "node": "Check webhook configure parameter",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check webhook configure parameter": {
      "main": [
        [
          {
            "node": "Verify Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variable": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter": {
      "main": [
        [
          {
            "node": "Add this Variable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "FAQ msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cancel Msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Interative Type Route": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "mapping_item1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "mapping_item1": {
      "main": [
        [
          {
            "node": "Send Multi Product Template",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compliance Info Post": {
      "main": [
        [
          {
            "node": "Compliance Info Get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message Type Routing": {
      "main": [
        [
          {
            "node": "Interative Type Route",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Variable2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Variable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Stock data": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If Stock is available",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error message": {
      "main": [
        [
          {
            "node": "Send msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Succes Msg": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send msg": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Variable2": {
      "main": [
        [
          {
            "node": "Get Stock data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert row": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet2": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Append row in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Stock is available": {
      "main": [
        [
          {
            "node": "Error message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Succes Msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Insert row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Send msg1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet4": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send msg2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add this Variable": {
      "main": [
        [
          {
            "node": "Message Type Routing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Compliance Info Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "45847c6d-e0ce-4151-8e3c-c5ecb7955ef7",
  "activeVersionId": "45847c6d-e0ce-4151-8e3c-c5ecb7955ef7",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-11-28T12:40:37.497Z",
      "createdAt": "2025-11-28T12:40:37.497Z",
      "role": "workflow:owner",
      "workflowId": "iH9rV8O93cjKMPM4",
      "projectId": "iOyc3VpWKvgHH9fv"
    }
  ],
  "activeVersion": {
    "updatedAt": "2025-12-01T16:35:46.784Z",
    "createdAt": "2025-12-01T16:35:46.784Z",
    "versionId": "45847c6d-e0ce-4151-8e3c-c5ecb7955ef7",
    "workflowId": "iH9rV8O93cjKMPM4",
    "nodes": [
      {
        "parameters": {
          "multipleMethods": true,
          "path": "whatsapp_catalog",
          "responseMode": "responseNode",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          1024,
          1296
        ],
        "id": "ad97b315-4e85-4490-9d0f-3182ab272887",
        "name": "Whatsapp Bot Webhook",
        "webhookId": "2b7f85b2-f581-46d9-8d22-172f7a9933c0"
      },
      {
        "parameters": {
          "respondWith": "text",
          "responseBody": "={{ $json.query[\"hub.challenge\"] }}",
          "options": {}
        },
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.4,
        "position": [
          1472,
          1200
        ],
        "id": "160c6dcf-a237-4b85-9d26-18efef956629",
        "name": "Verify Webhook"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "51696ba9-54b9-4f8c-bd0c-4e11fcb50d45",
                "leftValue": "={{ $json.query['hub.mode'] }}",
                "rightValue": "subscribe",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "4b041959-0ee0-4db3-8465-d08554bdec80",
                "leftValue": "={{ $json.query['hub.verify_token'] }}",
                "rightValue": "hello",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          1248,
          1200
        ],
        "id": "e17cb01c-0348-46c0-8341-a5970ef51909",
        "name": "Check webhook configure parameter"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "24009ed9-9dd8-4b22-9e15-ef5b4e0b1587",
                "name": "msg_from",
                "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.metadata.display_phone_number }}",
                "type": "string"
              },
              {
                "id": "2977f9b0-5df4-4d94-93a7-308724b31769",
                "name": "msg",
                "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].text.body }}",
                "type": "string"
              },
              {
                "id": "14d7554a-9415-4478-b26c-59d88b63d498",
                "name": "user_name",
                "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1920,
          1584
        ],
        "id": "a0622de7-dab1-45cb-a5f6-7a6be5f3dda9",
        "name": "Set Variable"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $('Add this Variable').item.json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"Hi {{ $json.user_name }} üëã \\nWelcome to Alister Bharat! You can:\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"browse_product\",\n            \"title\": \"Browse Product\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"order_status\",\n            \"title\": \"Order Status\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"ask_faq\",\n            \"title\": \"Ask FAQs\"\n          }\n        }\n      ]\n    }\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2144,
          1584
        ],
        "id": "f8d9ccc1-0aac-45b2-b762-3750729e6a86",
        "name": "HTTP Request",
        "credentials": {
          "httpHeaderAuth": {
            "id": "dMqgWEck6HIFxDk2",
            "name": "wa-agent app"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "897fa65a-47b7-4e25-b472-6f72bfc1d1c5",
                "leftValue": "={{ $json.body.entry[0].changes[0].value.statuses[0].status }}",
                "rightValue": "read",
                "operator": {
                  "type": "string",
                  "operation": "notExists",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2.2,
        "position": [
          1248,
          1392
        ],
        "id": "bb03b50b-5eb6-4368-bfc7-9daf1c74c7de",
        "name": "Filter"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b9ce7a61-a4ac-410d-a657-cc2043987041",
                      "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                      "rightValue": "confirm",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Confirm Order"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "fe1e27ee-c64f-4431-95f9-bc69d2b64f40",
                      "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                      "rightValue": "order_status",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                }
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "fa8a5bb5-2908-4bee-b7f7-b7d6cd329182",
                      "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                      "rightValue": "ask_faq",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Ask FAQs"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "1ac966a0-815a-4c1b-9c9c-2af2834b903f",
                      "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                      "rightValue": "cancel",
                      "operator": {
                        "type": "string",
                        "operation": "contains"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Cancel Order"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id }}",
                      "rightValue": "browse_product",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "a7c6ca04-7747-406d-ab76-cd29c0e07c09"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Browse Product"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          2144,
          768
        ],
        "id": "7bfcfb44-2fe1-48ca-b1c2-6646c9852034",
        "name": "Switch1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.type }}",
                      "rightValue": "button_reply",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "66f96ae4-4402-4323-8b49-2f569e97fbf3"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Button Reply"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          1920,
          816
        ],
        "id": "455d68a6-b636-4059-bd9b-d1e7e1e5d966",
        "name": "Interative Type Route"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
            "mode": "list",
            "cachedResultName": "catalog_products",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1401568257,
            "mode": "list",
            "cachedResultName": "demo sheet",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          3264,
          1216
        ],
        "id": "287206a1-b9fa-450e-a0a0-0579f5f933bd",
        "name": "Get row(s) in sheet3",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cZc9FZPSLRtIq9IL",
            "name": "Lakshit77 Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Convert Excel rows ‚Üí PROPER JSON array ready for Twilio\nconst MAX_ITEMS = 10;\n  const TITLE_MAX = 24;\nconst DESC_MAX = 72;\n\nconst rows = $input.all().map(i => i.json);\n\nfunction trunc(s,n){ \n  if (!s) return \"\"; \n  s = String(s); \n  return s.length<=n ? s : s.slice(0,n-1)+\"‚Ä¶\"; \n}\n\n// Order by in-stock first\nconst inStock = rows.filter(r => (r.availability || '').toLowerCase() === 'in stock');\nconst others   = rows.filter(r => !inStock.includes(r));\nconst ordered  = inStock.concat(others).slice(0, MAX_ITEMS);\n\n// Build Twilio List Picker items\nconst listItems = ordered.map(p => {\n  const id = String(p.id);\n  const title = trunc(p.title, TITLE_MAX);\n  const description = trunc(p.description ?? `‚Çπ${p.price} ‚Ä¢ ${p.availability}`, DESC_MAX);\n  return {\n    product_retailer_id: id\n  };\n});\n\n// Return BOTH versions:\n// 1. Normal JSON array\n// 2. Stringified JSON array (for display)\nreturn [{\n  json: {\n    items: listItems,\n    items_stringified: JSON.stringify(listItems, null, 2)\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3488,
          1216
        ],
        "id": "368e9667-6ffe-4738-8278-2a3653d6904a",
        "name": "mapping_item1"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          896,
          192
        ],
        "id": "6dd09c4f-adc8-4aee-bd9c-d7409b7a571a",
        "name": "When clicking ‚ÄòExecute workflow‚Äô"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v24.0/{{ $json.phone_number_id }}/business_compliance_info",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"entity_name\": \"Lakshit Ukani\",\n  \"entity_type\": \"SOLE_PROPRIETORSHIP\",\n  \"entity_registration_number\": \"AEEUU5907L\",\n  \"business_address\": {\n    \"street\": \"Mira road\",\n    \"city\": \"Thane\",\n    \"state\": \"Maharashtra\",\n    \"postal_code\": \"401107\",\n    \"country\": \"IN\"\n  },\n  \"customer_care_details\": {\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918163328947\"\n  },\n  \"grievance_officer_details\": {\n    \"name\": \"Lakshit Ukani\",\n    \"email\": \"laksh77@gmail.com\",\n    \"mobile_number\": \"+918122228947\"\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          1328,
          192
        ],
        "id": "e05dabcd-efdf-4ae1-97b6-6393a711126c",
        "name": "Compliance Info Post",
        "credentials": {
          "httpHeaderAuth": {
            "id": "dMqgWEck6HIFxDk2",
            "name": "wa-agent app"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://graph.facebook.com/v24.0/{{ $('Edit Fields3').item.json.phone_number_id }}/business_compliance_info",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          1552,
          192
        ],
        "id": "c93671a6-9656-4c8c-8a4e-fc7242a62272",
        "name": "Compliance Info Get",
        "credentials": {
          "httpHeaderAuth": {
            "id": "dMqgWEck6HIFxDk2",
            "name": "wa-agent app"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"product_list\",\n    \"header\": {\n      \"type\": \"text\",\n      \"text\": \"Baby Care Products\"\n    },\n    \"body\": {\n      \"text\": \"Check out our premium baby care collection\"\n    },\n    \"footer\": {\n      \"text\": \"Best prices guaranteed\"\n    },\n    \"action\": {\n      \"catalog_id\": \"896416602722897\",\n      \"sections\": [\n        {\n          \"title\": \"Diapers & Care\",\n          \"product_items\": \n            {{ JSON.stringify($json.items) }}\n        }\n      ]\n    }\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3744,
          1216
        ],
        "id": "118758f2-9368-425a-8adf-7bf40603e171",
        "name": "Send Multi Product Template",
        "credentials": {
          "httpHeaderAuth": {
            "id": "dMqgWEck6HIFxDk2",
            "name": "wa-agent app"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                      "rightValue": "interactive",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "38c2ee1e-5380-4c4c-906a-765cd35fff09"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Interactive"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "7bb670b9-8110-4d70-a382-9581cd025551",
                      "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                      "rightValue": "order",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Order"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "73114ba1-f1c6-4eb8-8f92-f9abf6d6cb29",
                      "leftValue": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].type }}",
                      "rightValue": "text",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.3,
        "position": [
          1696,
          1376
        ],
        "id": "02c980ef-89d7-4d6f-a5e8-e14eb5ef45fc",
        "name": "Message Type Routing"
      },
      {
        "parameters": {
          "content": "# Compliance Check for India",
          "height": 304,
          "width": 944
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          848,
          64
        ],
        "id": "10fe7dc9-fbef-4209-8aba-ecb4cde2f9dd",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
            "mode": "list",
            "cachedResultName": "catalog_products",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1401568257,
            "mode": "list",
            "cachedResultName": "demo sheet",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=1401568257"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2144,
          1392
        ],
        "id": "0322421b-dbf7-49e2-9a42-a30ebab8a2c2",
        "name": "Get Stock data",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cZc9FZPSLRtIq9IL",
            "name": "Lakshit77 Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Input 1 = WhatsApp webhook\n// Input 2 = Excel data\n\n// FIX 1: unwrap Excel rows from .all() ‚Üí each item is { json: { ... } }\nconst excelData = $('Get Stock data').all().map(item => item.json);\n\n// Extract all product_items from WhatsApp order\nconst productItems = $('Whatsapp Bot Webhook').first().json.body.entry[0].changes[0].value.messages[0].order.product_items\n\n// Collect errors\nlet errors = [];\n\nfor (const item of productItems) {\n  const selectedId = String(item.product_retailer_id).trim();\n  const selectedQty = Number(item.quantity);\n\n  // FIX 2: normalize Excel IDs to string\n  const match = excelData.find(p => String(p.id).trim() === selectedId);\n\n  if (!match) {\n    errors.push(`Product with ID ${selectedId} not found.`);\n    continue;\n  }\n\n  const available = Number(match.item_available);\n\n  if (available < selectedQty) {\n    errors.push(\n      `Only ${available} item(s) of \"${match.title}\" are available, but you selected ${selectedQty}.`\n    );\n  }\n}\n\n// FINAL DECISION\nif (errors.length === 0) {\n  return [\n    {\n      json: {\n        success: true,\n        message: \"Stock available for all selected items.\"\n      }\n    }\n  ];\n} else {\n  return [\n    {\n      json: {\n        success: false,\n        message: errors.join(\" | \")\n      }\n    }\n  ];\n}\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2368,
          1392
        ],
        "id": "db4b4d17-0669-4b58-95f7-afe2b007a820",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "bd52bbe8-7f92-4efe-8416-0d8d14246800",
                "name": "=msg_to_send",
                "value": "=Thanks for your order! üòÑ\nI checked the availability and here‚Äôs an update:\n\nSome items are currently not available in the quantity you selected:\n\nüëâ {{$json.message.replace(/\\|/g, \"\\nüëâ \")}}\n\nYou can update the quantities and let me know ‚Äî I‚Äôll place the order immediately for you!;",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2816,
          1296
        ],
        "id": "1645cfd9-e5af-4478-9d31-a1401db92330",
        "name": "Error message"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "018b7715-2bfd-48f9-b1da-63fb9b6209f0",
                "name": "msg_to_send",
                "value": "=Hey! üòä\nI checked the items you added to your cart.\n\nGood news: Everything you selected is in stock and ready to go!\nPlease confirm your order to continue.",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2816,
          1488
        ],
        "id": "ef060747-6287-4e4d-81ca-6282b5ff9544",
        "name": "Succes Msg"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $node['Add this Variable'].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"{{ $json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3040,
          1296
        ],
        "id": "f69be331-45d6-4be1-848a-e0a7ea5ffc36",
        "name": "Send msg",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
                "name": "catalog_id",
                "value": "896416602722897",
                "type": "string"
              },
              {
                "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
                "name": "msg_to",
                "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1920,
          1392
        ],
        "id": "1ec2b121-697c-47ed-8057-0ed031d92b69",
        "name": "Set Variable2"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v24.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"recipient_type\": \"individual\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"interactive\",\n  \"interactive\": {\n    \"type\": \"button\",\n    \"body\": {\n      \"text\": \"{{ $('Succes Msg').item.json.msg_to_send.replace(/\\n/g, '\\\\n').replace(/\"/g, \"'\") }}\"\n    },\n    \"action\": {\n      \"buttons\": [\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_confirm\",\n            \"title\": \"Confirm\"\n          }\n        },\n        {\n          \"type\": \"reply\",\n          \"reply\": {\n            \"id\": \"{{ $('Edit Fields1').item.json.unique_id_of_order }}_cancel\",\n            \"title\": \"Cancel\"\n          }\n        }\n      ]\n    }\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          4160,
          1488
        ],
        "id": "a7ca8060-bf83-49ea-bd2e-0a56188b05be",
        "name": "HTTP Request2",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {
          "dataTableId": {
            "__rl": true,
            "value": "htaS8wafCR4Eh7v5",
            "mode": "list",
            "cachedResultName": "Alister Order Stage",
            "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "phone_no": "={{ $('Edit Fields1').item.json.user_phone_no }}",
              "unique_order_id": "={{ $('Edit Fields1').item.json.unique_id_of_order }}",
              "user_name": "={{ $('Edit Fields1').item.json.user_name }}",
              "product_id": "={{ $json.product_retailer_id }}",
              "product_quantity": "={{ $json.quantity }}",
              "product_title": "={{ $json.title }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "unique_order_id",
                "displayName": "unique_order_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "user_name",
                "displayName": "user_name",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "phone_no",
                "displayName": "phone_no",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "product_id",
                "displayName": "product_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "product_title",
                "displayName": "product_title",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              },
              {
                "id": "product_quantity",
                "displayName": "product_quantity",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "readOnly": false,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1,
        "position": [
          3712,
          1488
        ],
        "id": "b7e17d1f-b0fc-479c-8d7f-8ef6dcb442a1",
        "name": "Insert row"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c618dbc9-40d0-4cd6-b164-60a462ceb16e",
                "name": "user_selected_product",
                "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.messages[0].order.product_items }}",
                "type": "array"
              },
              {
                "id": "41163f52-519c-4a26-8f60-c5cbb759a21c",
                "name": "unique_id_of_order",
                "value": "={{ 'ORD-' + Date.now() + '-' + Math.floor(Math.random() * 10000) }}",
                "type": "string"
              },
              {
                "id": "21053b3f-1909-4bb3-9888-561355df41bc",
                "name": "user_name",
                "value": "={{ $node['Whatsapp Bot Webhook'].json.body.entry[0].changes[0].value.contacts[0].profile.name }}",
                "type": "string"
              },
              {
                "id": "36d108e7-b62c-4145-822c-640f588557a9",
                "name": "user_phone_no",
                "value": "={{ $node['Add this Variable'].json.msg_to }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          3040,
          1488
        ],
        "id": "489e65b0-1670-48b4-889d-b73e76ed1ddc",
        "name": "Edit Fields1"
      },
      {
        "parameters": {
          "fieldToSplitOut": "user_selected_product",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          3264,
          1488
        ],
        "id": "248d45a0-08b9-4521-8479-dd6cf8a756b1",
        "name": "Split Out"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b414d52e-386d-4c0e-8eac-d0aeb8135ad6",
                "name": "order_id",
                "value": "={{ $('Whatsapp Bot Webhook').item.json.body.entry[0].changes[0].value.messages[0].interactive.button_reply.id.split(\"_\")[0] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          2368,
          432
        ],
        "id": "e1e3a5a9-7059-4677-801f-354879769e99",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
            "mode": "list",
            "cachedResultName": "catalog_products",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 38109468,
            "mode": "list",
            "cachedResultName": "Order List",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Phone Number": "={{ $json.phone_no }}",
              "User": "={{ $json.user_name }}",
              "Item_id": "={{ $json.product_id }}",
              "Item": "={{ $json.product_title }}",
              "Quantity": "={{ $json.product_quantity }}",
              "Date": "={{ $now.setZone('Asia/Kolkata').format('yyyy-MM-dd T') }}",
              "Status": "Order Placed",
              "Order ID": "={{ $('Edit Fields2').item.json.order_id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Date",
                "displayName": "Date",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Order ID",
                "displayName": "Order ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phone Number",
                "displayName": "Phone Number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "User",
                "displayName": "User",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Item_id",
                "displayName": "Item_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Item",
                "displayName": "Item",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Quantity",
                "displayName": "Quantity",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2816,
          432
        ],
        "id": "21c940fd-4713-440b-b35f-008254bfbeb3",
        "name": "Append row in sheet2",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cZc9FZPSLRtIq9IL",
            "name": "Lakshit77 Account"
          }
        }
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "htaS8wafCR4Eh7v5",
            "mode": "list",
            "cachedResultName": "Alister Order Stage",
            "cachedResultUrl": "/projects/iOyc3VpWKvgHH9fv/datatables/htaS8wafCR4Eh7v5"
          },
          "matchType": "allConditions",
          "filters": {
            "conditions": [
              {
                "keyName": "unique_order_id",
                "keyValue": "={{ $('Edit Fields2').item.json.order_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1,
        "position": [
          2592,
          432
        ],
        "id": "af4b658b-7687-4d14-af63-ecbb09bb15d2",
        "name": "Get row(s)"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "263eb8a1-0b0b-4e98-bede-2ca52dc566ed",
                "leftValue": "={{ $json.success }}",
                "rightValue": "false",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          2592,
          1392
        ],
        "id": "cf743aae-cb26-4a5d-9bbd-61b5b58c4b0b",
        "name": "If Stock is available"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.limit",
        "typeVersion": 1,
        "position": [
          3936,
          1488
        ],
        "id": "f0aa58a5-feef-41f6-bb52-5e4c4f1712b2",
        "name": "Limit"
      },
      {
        "parameters": {
          "jsCode": "// Load data from nodes\nconst product_data = $(\"Get Stock data\").all().map(item => item.json);\nconst user_selected_data = $(\"Split Out\").all().map(item => item.json);\n\n// Final output list\nlet matched = [];\n\n// Loop through user-selected items\nfor (const userItem of user_selected_data) {\n  \n  const selectedId = String(userItem.product_retailer_id).trim();\n\n  // Find matching product from stock data\n  const stockItem = product_data.find(\n    p => String(p.id).trim() === selectedId\n  );\n\n  // If matched ‚Üí append combined data\n  if (stockItem) {\n    matched.push({\n      product_retailer_id: selectedId,\n      title: stockItem.title,\n      quantity: userItem.quantity\n    });\n  }\n}\n\n// Return result\nreturn matched.map(m => ({ json: m }));\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3488,
          1488
        ],
        "id": "a9a0961d-e130-4d00-9d99-ffc68802907c",
        "name": "Code in JavaScript1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order has been placed and we will deliver soon\"\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          3264,
          432
        ],
        "id": "39e9c19c-304f-41ea-bef6-3f37f1b73458",
        "name": "Send msg1",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.limit",
        "typeVersion": 1,
        "position": [
          3040,
          432
        ],
        "id": "b908c38c-cdfd-41ec-a692-a9a9b3f30a00",
        "name": "Limit1"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"Your Order Has Been Cancel \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2368,
          1008
        ],
        "id": "a7e2b8fe-e521-49d4-bd33-9f36d1f86931",
        "name": "Cancel Msg",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": \"This Feature is under Development \\nIf you want inital menu, type 'Menu' or 'Hello'\"\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2368,
          816
        ],
        "id": "a5274428-c8cd-41c4-bea8-9f8cc57b66df",
        "name": "FAQ msg",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {
          "content": "# Official Meta Connection",
          "height": 1392,
          "width": 3536
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          848,
          400
        ],
        "id": "2aeec772-8a5d-4b22-ac49-81f502fe8e98",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU",
            "mode": "list",
            "cachedResultName": "catalog_products",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 38109468,
            "mode": "list",
            "cachedResultName": "Order List",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1qNcwhfZ3p9c6UdqmrroMieFeawXX_UND-OMsRnEjbSU/edit#gid=38109468"
          },
          "filtersUI": {
            "values": [
              {
                "lookupColumn": "Phone Number",
                "lookupValue": "={{ $json.msg_to }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          2368,
          624
        ],
        "id": "466f6194-c6c8-40a8-999b-3e3a6ec66645",
        "name": "Get row(s) in sheet4",
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cZc9FZPSLRtIq9IL",
            "name": "Lakshit77 Account"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Load orders from sheet4\nconst order_list = $(\"Get row(s) in sheet4\").all().map(item => item.json);\n\n// If empty\nif (!order_list.length) {\n  return [{ json: { message: \"You have no orders at the moment.\" } }];\n}\n\n// Group by Order ID\nconst grouped = {};\n\nfor (const row of order_list) {\n  const orderId = row[\"Order ID\"];\n\n  if (!grouped[orderId]) {\n    grouped[orderId] = {\n      items: [],\n      status: row.Status,\n    };\n  }\n\n  grouped[orderId].items.push({\n    item: row.Item,\n    quantity: row.Quantity,\n  });\n}\n\n// Build the message\nlet msg = \"üì¶ *Your Order Summary*\\n\\nHere‚Äôs a quick overview of all your recent orders:\\n\\n\";\n\nfor (const [orderId, data] of Object.entries(grouped)) {\n  const totalQty = data.items.reduce((sum, i) => sum + Number(i.quantity), 0);\n\n  msg += `üßæ *Order ID:* ${orderId}\\n`;\n  msg += `üì¶ *Total Items:* ${totalQty}\\n`;\n  msg += `üìå *Status:* ${data.status}\\n`;\n  msg += `üõçÔ∏è *Items:*\\n`;\n\n  for (const item of data.items) {\n    msg += `   ‚Ä¢ ${item.item} √ó${item.quantity}\\n`;\n  }\n\n  msg += `\\n`;\n}\n\n// msg += \"üí¨ If you'd like to *track*, *change*, or *cancel* any order, just reply with the Order ID (e.g., *ORD-1764326177122-8178*).\";\n\n// Return final message\nreturn [{ json: { message: msg } }];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2592,
          624
        ],
        "id": "cec5408f-0867-43a6-9754-a3216579a337",
        "name": "Code in JavaScript2"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://graph.facebook.com/v22.0/{{ $items('Add this Variable')[0].json.phone_number_id }}/messages",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"messaging_product\": \"whatsapp\",\n  \"to\": \"{{ $items('Add this Variable')[0].json.msg_to }}\",\n  \"type\": \"text\",\n  \"text\": {\n    \"body\": {{ JSON.stringify($json.message) }}\n  }\n}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2816,
          624
        ],
        "id": "fbb4dd26-2ef4-42d9-9826-8f4285051052",
        "name": "Send msg2",
        "credentials": {
          "httpHeaderAuth": {
            "id": "iR5q4Pc809XWa04V",
            "name": "whatsapp wa-agent-alister app Lakshit"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "ba2ea282-f5f0-4215-8cfc-eb3d30f46dfd",
                "name": "catalog_id",
                "value": "1877812469777617",
                "type": "string"
              },
              {
                "id": "374ced34-cfa5-4dd1-a21b-3e73d722d2d3",
                "name": "msg_to",
                "value": "={{ $json.body.entry[0].changes[0].value.contacts[0].wa_id }}",
                "type": "string"
              },
              {
                "id": "bafa1b69-5374-4c42-ac6c-766dab6487e3",
                "name": "phone_number_id",
                "value": "924412964080974",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1472,
          1392
        ],
        "id": "e35c5e1d-5836-462b-bbbf-879871ba840f",
        "name": "Add this Variable"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "528835a6-bfc1-4ef6-88da-fab4dfda48df",
                "name": "phone_number_id",
                "value": "924412964080974",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          1104,
          192
        ],
        "id": "beb4704f-b312-4c40-bfbb-88fd7dd85fb9",
        "name": "Edit Fields3"
      }
    ],
    "connections": {
      "Whatsapp Bot Webhook": {
        "main": [
          [
            {
              "node": "Check webhook configure parameter",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Filter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check webhook configure parameter": {
        "main": [
          [
            {
              "node": "Verify Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Variable": {
        "main": [
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter": {
        "main": [
          [
            {
              "node": "Add this Variable",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch1": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get row(s) in sheet4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "FAQ msg",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Cancel Msg",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get row(s) in sheet3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Interative Type Route": {
        "main": [
          [
            {
              "node": "Switch1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet3": {
        "main": [
          [
            {
              "node": "mapping_item1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "mapping_item1": {
        "main": [
          [
            {
              "node": "Send Multi Product Template",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Edit Fields3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Compliance Info Post": {
        "main": [
          [
            {
              "node": "Compliance Info Get",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Message Type Routing": {
        "main": [
          [
            {
              "node": "Interative Type Route",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Variable2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Set Variable",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Stock data": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "If Stock is available",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error message": {
        "main": [
          [
            {
              "node": "Send msg",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Succes Msg": {
        "main": [
          [
            {
              "node": "Edit Fields1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send msg": {
        "main": [
          [
            {
              "node": "Get row(s) in sheet3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Variable2": {
        "main": [
          [
            {
              "node": "Get Stock data",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insert row": {
        "main": [
          [
            {
              "node": "Limit",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields1": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Code in JavaScript1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Append row in sheet2": {
        "main": [
          [
            {
              "node": "Limit1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          [
            {
              "node": "Append row in sheet2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Stock is available": {
        "main": [
          [
            {
              "node": "Error message",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Succes Msg",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limit": {
        "main": [
          [
            {
              "node": "HTTP Request2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript1": {
        "main": [
          [
            {
              "node": "Insert row",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Limit1": {
        "main": [
          [
            {
              "node": "Send msg1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet4": {
        "main": [
          [
            {
              "node": "Code in JavaScript2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript2": {
        "main": [
          [
            {
              "node": "Send msg2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add this Variable": {
        "main": [
          [
            {
              "node": "Message Type Routing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields3": {
        "main": [
          [
            {
              "node": "Compliance Info Post",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Lakshit Ukani",
    "name": null,
    "description": null
  },
  "tags": []
}